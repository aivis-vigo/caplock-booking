<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Bookings')}"></head>
<body>
<nav th:replace="~{fragments/layout :: nav}"></nav>

<main>
    <div class="page-header">
        <h1>My Bookings</h1>
        <form th:action="@{/bookings/form}" method="get" style="display:flex; gap:.5rem; align-items:center;">
            <input type="text" name="id" placeholder="Booking ID" style="padding:.45rem .75rem; border:1px solid #e2e8f0; border-radius:6px; font-size:.875rem; width:180px;">
            <button type="submit" class="btn btn-primary">Open</button>
        </form>
    </div>

    <div class="card" style="padding:0; overflow:hidden;">
        <table th:if="${bookingList != null and !bookingList.isEmpty()}">
            <thead>
            <tr>
                <th>Booking ID</th>
                <th>Status</th>
                <th>Event</th>
                <th>Seats</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="b : ${bookingList}">
                <td>
                    <code style="font-size:.8125rem; background:#f1f5f9; padding:.15rem .4rem; border-radius:4px;"
                          th:text="${b.id}">bk-1</code>
                </td>
                <td>
                    <span class="badge"
                          th:classappend="${b.status != null and b.status.name() == 'Processed'} ? 'badge-blue'
                                        : (${b.status != null and b.status.name() == 'Fulfilled'} ? 'badge-green'
                                        : (${b.status != null and b.status.name() == 'Cancelled'} ? 'badge-red' : 'badge-yellow'))"
                          th:text="${b.status}">PENDING</span>
                </td>
                <td>
                    <div th:text="${b.eventTitle}" style="font-weight:600;">Event Title</div>
                    <div th:text="${b.eventLocation}" style="font-size:.8rem; color:#64748b;">Location</div>
                </td>
                <td th:text="${b.seats != null and !b.seats.isEmpty() ? #strings.listJoin(b.seats, ', ') : 'â€”'}">A1, A2</td>
                <td>
                    <div class="btn-group">
                        <a class="btn btn-view" th:href="@{/bookings/details/view/{id}(id=${b.id})}">Details</a>
                        <a class="btn btn-edit" th:href="@{/bookings/form/{eventId}/{id}(id=${b.id}, eventId=${b.eventId})}">Edit</a>
                        <form th:action="@{/bookings/delete/{id}(id=${b.id})}" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-danger"
                                    onclick="return confirm('Cancel this booking?');">Cancel</button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <p class="empty" th:if="${bookingList == null or bookingList.isEmpty()}">No bookings found.</p>
    </div>
</main>
</body>
</html>
