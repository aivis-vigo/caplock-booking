<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Booking Form')}"></head>
<body>
<nav th:replace="~{fragments/layout :: nav}"></nav>

<main>
    <div class="page-header">
        <h1 th:text="${editing ? 'Edit Booking' : 'New Booking'}">Booking</h1>
        <a class="btn btn-ghost" th:href="@{/bookings/}">← Back</a>
    </div>

    <div th:if="${errorMessage != null}" class="alert-error" th:text="${errorMessage}">Error</div>

    <form th:object="${bookingForm}"
          th:action="${editing ? @{/bookings/submitEditForm} : @{/bookings/submitForm}}"
          method="post"
          style="display:grid; grid-template-columns:1fr 1fr; gap:1.5rem;">

        <input type="hidden" name="_method" value="PUT" th:if="${editing}"/>
        <input type="hidden" th:field="*{eventId}">
        <input type="hidden" th:field="*{userId}">
        <input type="hidden" name="bookingId" th:value="*{bookingId}">
        <input type="hidden" th:field="*{status}">

        <!-- Event Info card -->
        <div class="card">
            <h2>Event</h2>
            <dl class="kv">
                <dt>Title</dt>
                <dd th:text="*{eventTitle ?: '—'}">—</dd>

                <dt>Event ID</dt>
                <dd th:text="*{eventId}">—</dd>

                <dt>Date</dt>
                <dd th:if="*{eventDate != null}"
                    th:text="${#temporals.format(bookingForm.eventDate, 'MMM d, yyyy HH:mm')}">—</dd>
                <dd th:if="*{eventDate == null}" style="color:#64748b;">—</dd>

                <dt>Start Time</dt>
                <dd th:if="*{eventStartTime != null}"
                    th:text="${#temporals.format(bookingForm.eventStartTime, 'MMM d, yyyy HH:mm')}">—</dd>
                <dd th:if="*{eventStartTime == null}" style="color:#64748b;">—</dd>

                <dt>Location</dt>
                <dd th:text="*{eventLocation ?: '—'}">—</dd>
            </dl>
        </div>

        <!-- Seat selection card -->
        <div class="card">
            <h2>Seat Selection</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="section">Section</label>
                    <input id="section" type="text" name="seats[0].section"
                           th:value="${bookingForm.seats != null and bookingForm.seats.size() > 0 ? bookingForm.seats.get(0).section() : ''}"
                           placeholder="e.g. A" required>
                </div>

                <div class="form-group">
                    <label for="row">Row</label>
                    <input id="row" type="text" name="seats[0].row"
                           th:value="${bookingForm.seats != null and bookingForm.seats.size() > 0 ? bookingForm.seats.get(0).row() : ''}"
                           placeholder="e.g. 3" required>
                </div>

                <div class="form-group" style="grid-column:1/-1;">
                    <label for="seatNumber">Seat Number</label>
                    <input id="seatNumber" type="text" name="seats[0].seatNumber"
                           th:value="${bookingForm.seats != null and bookingForm.seats.size() > 0 ? bookingForm.seats.get(0).seatNumber() : ''}"
                           placeholder="e.g. 12" required>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary"
                        th:text="${editing ? 'Update Booking' : 'Confirm Booking'}">Submit</button>
                <a class="btn btn-ghost" th:href="@{/bookings/}">Cancel</a>
            </div>

            <p style="font-size:.8rem; color:#64748b; margin-top:1rem;">
                Booking for user ID: <strong th:text="*{userId}">1</strong>
            </p>
        </div>

    </form>
</main>
</body>
</html>
